<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>performance lab - debug.tips</title>
  <style>
    .facade-minimal{position:relative;margin:24px 0;padding:64px 16px 10px 16px;box-shadow:0 5px 10px rgba(0,0,0,0.1);font-family:sans-serif;color:#454545;border-radius:3px;overflow-x:hidden}.facade-minimal:before{content:"";position:absolute;display:block;top:-1px;left:-1px;right:-1px;height:56px;border-bottom:1px solid rgba(0,0,0,0.05);border-radius:3px 3px 0 0;background:url('data:image/svg+xml;charset=utf-8,<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg version="1.1" id="minimal-browser-button" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="16px" height="16px" viewBox="0 0 16 16" enable-background="new 0 0 16 16" xml:space="preserve"><g id="Ellipse_1"><g><circle fill-rule="evenodd" clip-rule="evenodd" fill="%23B3B3B3" cx="8" cy="8" r="5"/></g></g></svg>') 16px 22px no-repeat,url('data:image/svg+xml;charset=utf-8,<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg version="1.1" id="minimal-browser-button" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="16px" height="16px" viewBox="0 0 16 16" enable-background="new 0 0 16 16" xml:space="preserve"><g id="Ellipse_1"><g><circle fill-rule="evenodd" clip-rule="evenodd" fill="%23B3B3B3" cx="8" cy="8" r="5"/></g></g></svg>') 32px 22px no-repeat,url('data:image/svg+xml;charset=utf-8,<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg version="1.1" id="minimal-browser-button" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="16px" height="16px" viewBox="0 0 16 16" enable-background="new 0 0 16 16" xml:space="preserve"><g id="Ellipse_1"><g><circle fill-rule="evenodd" clip-rule="evenodd" fill="%23B3B3B3" cx="8" cy="8" r="5"/></g></g></svg>') 48px 22px no-repeat,url('data:image/svg+xml;charset=utf-8,<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg version="1.1" id="minimal-browser-settings" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="16px" height="16px" viewBox="0 0 16 16" enable-background="new 0 0 16 16" xml:space="preserve"><g id="Menu_icon"><g><path fill-rule="evenodd" clip-rule="evenodd" fill="%23B3B3B3" d="M1,1v3h14V1H1z M1,10h14V7H1V10z M1,16h14v-3H1V16z"/></g></g></svg>') right 16px top 22px no-repeat,#e8e8e8}.facade-minimal:after{content:attr(data-url);position:absolute;padding:2px 16px 0 32px;top:16px;height:24px;left:80px;right:48px;border-radius:3px;box-shadow:inset 0 1px 1px -1px rgba(0,0,0,0.5);font-size:12px;line-height:24px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;direction:rtl;text-align:left;background:url('data:image/svg+xml;charset=utf-8,<svg version="1.1" id="Refresh_icon_1_" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="16px" height="16px" viewBox="0 0 16 16" enable-background="new 0 0 16 16" xml:space="preserve"><g id="minimal-browser-refresh"><g><path fill-rule="evenodd" clip-rule="evenodd" fill="%23B3B3B3" d="M12.5,10.9l2.5-3h-1.7C13.2,4.6,10.7,2,7.7,2C4.5,2,2,4.7,2,8c0,3.3,2.5,6,5.7,6c1.3,0,2.5-0.5,3.5-1.3l-1-1.1c-0.7,0.5-1.6,0.9-2.5,0.9c-2.3,0-4.2-2-4.2-4.5s1.9-4.5,4.2-4.5c2.3,0,4.2,1.9,4.2,4.4h-2L12.5,10.9z"/></g></g></svg>') 8px 6px no-repeat,#FFFFFF}
  </style>
  <style>
    html, body { margin: 0; padding: 0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
    body { display: flex; justify-content: space-between; align-items: stretch; height: 100vh; }
    .left { flex-basis: 30%; padding-left: 20px; }
    .right { flex-basis: 70%; padding-right: 20px; }
    .right iframe { min-height:60vh; width: 100%; border: none; }
  </style>
</head>
<body>
  <div class="left">
    <h1>Performance Lab</h1>
    <p>a set of devised scenarios to demonstrate what performance metrics are like for different situation</p>
    <a href="#">Reset</a>
    <ul>
      <li><a href="#slow-html" data-delay="2000">slow HTML</a></li>
    </ul>
  </div>
  <div class="right">
    <div class="facade-minimal" data-url="about:blank" id="browser">
      <iframe id="iframe" seamless src="./scenarios/starter.html"></iframe>
    </div>
    <span class="timer">
      <span class="label" id="label">Idle</span>
      <span class="value" id="time">-</span>
    </span>
  </div>
  <script>
    let relativeStart;
    let loaded = false;

    window.addEventListener('hashchange', () => {
      const hash = location.hash.slice(1);
      const btn = document.querySelector(`[href="#${hash}"]`);

      let rafTimer = null;

      if (hash === '') {
        iframe.src = './scenarios/starter.html';
        browser.setAttribute('data-url', 'about:blank');
        label.textContent = 'Idle';
        time.textContent = '-';
      } else {
        browser.setAttribute('data-url', `${hash}.html`);

        iframe.addEventListener('load', () => {
          if (iframe.contentWindow.location.href !== '/') {
            loaded = true;
            time.textContent = iframe.contentWindow.performance.now();
            label.textContent = 'Loaded';
            cancelAnimationFrame(rafTimer);
          }
        });

        label.textContent = 'Loading';
        loaded = false;
        relativeStart = iframe.contentWindow.performance.now();
        iframe.src = `./scenarios/${hash}.html${btn.getAttribute('data-delay') ? `?delay=${btn.getAttribute('data-delay')}` : ''}`;

        rafTimer = requestAnimationFrame(updateTimer);
      }
    });

    function updateTimer() {
      if (loaded) {
        return cancelAnimationFrame(rafTimer);
      }
      time.textContent = iframe.contentWindow.performance.now() - relativeStart;
      rafTimer = requestAnimationFrame(updateTimer);
    }
  </script>
</body>
</html>
